{% extends "base.html" %}
{% block title %}ëŒ€ì‹œë³´ë“œ{% endblock %}
{% block content %}
<h2>ëŒ€ì‹œë³´ë“œ</h2>
<form method="get" action="{{ url_for('dashboard') }}" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
  <label for="query" style="font-size: 16px; white-space: nowrap;">ìƒí’ˆ ê²€ìƒ‰:</label>
  <input type="text" name="query" id="query" value="{{ query or '' }}" required 
         style="width: 250px; height: 36px; padding: 5px 10px; font-size: 14px;">
  <button type="submit" style="
    height: 36px;
    width: 36px;
    padding: 0;
    font-size: 16px;
    background-color: #007AFF;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  " title="ê²€ìƒ‰">ğŸ”</button>
</form>


<!-- âœ… ê²€ìƒ‰ ê²°ê³¼ ì—†ì„ ë•Œ íŒì—… ì•Œë¦¼ -->
{% if query and products|length == 0 %}
  <script>alert("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");</script>
{% endif %}
<h3>ë“±ë¡ëœ ìƒí’ˆ</h3>
<ul>
  {% for product in products %}
    <li>
      <a href="{{ url_for('view_product', product_id=product.id) }}">{{ product.title }}</a>
      - ê°€ê²©: {{ product.price }}
    </li>
  {% endfor %}
</ul>
<p><a href="{{ url_for('new_product') }}">ìƒˆ ìƒí’ˆ ë“±ë¡</a></p>

<h3>ì‹¤ì‹œê°„ ì±„íŒ…</h3>
<div id="chat">
  <ul id="messages"></ul>
  <input id="chat_input" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
  <button type="button" onclick="sendMessage()">ì „ì†¡</button>
</div>

<script type="text/javascript">
  // ì†Œì¼“ ì—°ê²° ë³€ìˆ˜ëª… ë³€ê²½
  var socketClient = io();

  // ì†Œì¼“ ì—°ê²° í™•ì¸
  socketClient.on('connect', function() {
    console.log("ì±„íŒ… ì„œë²„ì— ì—°ê²°ë¨");
  });

  // ë©”ì‹œì§€ ìˆ˜ì‹ 
  socketClient.on('message', function(data) {
    var messages = document.getElementById('messages');
    var item = document.createElement('li');
    item.textContent = data.username + ": " + data.message;
    messages.appendChild(item);
    window.scrollTo(0, document.body.scrollHeight);
  });

  // ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
  function sendMessage() {
    var input = document.getElementById('chat_input');
    var message = input.value;
    if (message) {
      socketClient.emit('send_message', { 'username': "{{ user.username }}", 'message': message });
      input.value = "";
    }
  }
</script>

{% endblock %}
